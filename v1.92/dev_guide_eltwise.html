<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>DNNL: Eltwise</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">Deep Neural Network Library (DNNL)
   &#160;<span id="projectnumber">1.92.0</span>
   </div>
   <div id="projectbrief">Performance library for Deep Learning</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Eltwise </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p></p>
<p><a class="el" href="group__dnnl__api__eltwise.html">API Reference</a></p>
<p></p>
</blockquote>
<p>The eltwise primitive applies an operation to every element of the tensor:</p>
<p class="formulaDsp">
\[ dst(\overline{x}) = Operation(src(\overline{x})), \]
</p>
<p>where \(\overline{x} = (x_n, .., x_0)\).</p>
<p>The following operations are supported:</p>
<table class="doxtable">
<tr>
<th align="left">Operation </th><th align="left">DNNL algorithm kind </th><th align="left">Formula  </th></tr>
<tr>
<td align="left">abs </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a2ac04aed39c46f6d6356744d9d12df43" title="Eltwise: abs. ">dnnl_eltwise_abs</a> </td><td align="left">\( f(x) = \begin{cases} x &amp; \text{if}\ x &gt; 0 \\ -x &amp; \text{if}\ x \leq 0 \end{cases} \) </td></tr>
<tr>
<td align="left">bounded_relu </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23aed5e7f85cc5d7dfeacefe6a7a5032502" title="Eltwise: bounded_relu. ">dnnl_eltwise_bounded_relu</a> </td><td align="left">\( f(x) = \begin{cases} \alpha &amp; \text{if}\ x &gt; \alpha, \alpha \geq 0 \\ x &amp; \text{if}\ 0 &lt; x \leq \alpha \\ 0 &amp; \text{if}\ x \leq 0 \end{cases} \) </td></tr>
<tr>
<td align="left">clip </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a026ef822b5cc28653e0730f8c8c2cf32" title="Eltwise: clip. ">dnnl_eltwise_clip</a> </td><td align="left">\( f(x) = \begin{cases} \beta &amp; \text{if}\ x &gt; \beta, \beta \geq \alpha \\ x &amp; \text{if}\ \alpha &lt; x \leq \beta \\ \alpha &amp; \text{if}\ x \leq \alpha \end{cases} \) </td></tr>
<tr>
<td align="left">elu </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a7afda2aa9bac4a229909522235f461b5" title="Eltwise: parametric exponential linear unit (elu) ">dnnl_eltwise_elu</a> </td><td align="left">\( f(x) = \begin{cases} x &amp; \text{if}\ x &gt; 0 \\ \alpha (e^x - 1) &amp; \text{if}\ x \leq 0 \end{cases} \) </td></tr>
<tr>
<td align="left">exp </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a4859f1326783a273500ef294bb7c7d5c" title="Eltwise: exponent. ">dnnl_eltwise_exp</a> </td><td align="left">\( f(x) = e^x \) </td></tr>
<tr>
<td align="left">gelu </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a4dd9cf08e3bebffb5d14e24c7d513f64" title="Eltwise: gelu. ">dnnl_eltwise_gelu</a> </td><td align="left">\( f(x) = 0.5 x (1 + tanh[\sqrt{\frac{2}{\pi}} (x + 0.044715 x^3)])\) </td></tr>
<tr>
<td align="left">linear </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23aed5eec69000ddfe6ac96e161b0d723b4" title="Eltwise: linear. ">dnnl_eltwise_linear</a> </td><td align="left">\( f(x) = \alpha x + \beta \) </td></tr>
<tr>
<td align="left">log </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a8ea10785816fd41353b49445852e0b74" title="Eltwise: natural logarithm. ">dnnl_eltwise_log</a> </td><td align="left">\( f(x) = \log_{e}{x} \) </td></tr>
<tr>
<td align="left">logistic </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23ab560981bee9e7711017423e29ba46071" title="Eltwise: logistic. ">dnnl_eltwise_logistic</a> </td><td align="left">\( f(x) = \frac{1}{1+e^{-x}} \) </td></tr>
<tr>
<td align="left">relu </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a5e37643fec6531331e2e38df68d4c65a" title="Eltwise: ReLU. ">dnnl_eltwise_relu</a> </td><td align="left">\( f(x) = \begin{cases} x &amp; \text{if}\ x &gt; 0 \\ \alpha x &amp; \text{if}\ x \leq 0 \end{cases} \) </td></tr>
<tr>
<td align="left">soft_relu </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a82d95f7071af086d4b1652160d9a972f" title="Eltwise: soft_relu. ">dnnl_eltwise_soft_relu</a> </td><td align="left">\( f(x) = \log_{e}(1+e^x) \) </td></tr>
<tr>
<td align="left">sqrt </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a2152d4664761b356bbceed3d9afe2189" title="Eltwise: square root. ">dnnl_eltwise_sqrt</a> </td><td align="left">\( f(x) = \sqrt{x} \) </td></tr>
<tr>
<td align="left">square </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a4da34cea03ccb7cc2701b2f2023bcc2e" title="Eltwise: square. ">dnnl_eltwise_square</a> </td><td align="left">\( f(x) = x^2 \) </td></tr>
<tr>
<td align="left">swish </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a63447dedf2e45ab535f1365502ff3240" title="Eltwise: swish. ">dnnl_eltwise_swish</a> </td><td align="left">\( f(x) = \frac{x}{1+e^{-\alpha x}} \) </td></tr>
<tr>
<td align="left">tanh </td><td align="left"><a class="el" href="group__dnnl__api__primitives__common.html#gga96946c805f6c4922c38c37049ab95d23a81b20d8f0b54c7114024186a9fbb698e" title="Eltwise: hyperbolic tangent non-linearity (tanh) ">dnnl_eltwise_tanh</a> </td><td align="left">\( f(x) = \tanh{x} \) </td></tr>
</table>
<h4>Difference Between Forward Training and Forward Inference</h4>
<p>There is no difference between the <a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a992e03bebfe623ac876b3636333bbce0" title="Forward data propagation (training mode). ">dnnl_forward_training</a> and <a class="el" href="group__dnnl__api__primitives__common.html#ggae3c1f22ae55645782923fbfd8b07d0c4a2f77a568a675dec649eb0450c997856d" title="Forward data propagation (inference mode). ">dnnl_forward_inference</a> propagation kinds.</p>
<h3>Backward</h3>
<p>The backward propagation computes \(diff\_src(\overline{x})\), based on \(diff\_dst(\overline{x})\) and \(src(\overline{x})\).</p>
<h2>Implementation Details</h2>
<h3>General Notes</h3>
<ol type="1">
<li>All eltwise primitives have a common initialization function (e.g., <a class="el" href="structdnnl_1_1eltwise__forward_1_1desc.html#ae7c6744d2c292b00441577291323fe84" title="Constructs a descriptor for an elementwise forward propagation primitive. ">dnnl::eltwise_forward::desc::desc()</a>) which takes both parameters \(\alpha\), and \(\beta\). These parameters are ignored if they are unused.</li>
<li>The memory format and data type for <code>src</code> and <code>dst</code> are assumed to be the same, and in the API are typically referred as <code>data</code> (e.g., see <code>data_desc</code> in <a class="el" href="structdnnl_1_1eltwise__forward_1_1desc.html#ae7c6744d2c292b00441577291323fe84" title="Constructs a descriptor for an elementwise forward propagation primitive. ">dnnl::eltwise_forward::desc::desc()</a>). The same holds for <code>diff_src</code> and <code>diff_dst</code>. The corresponding memory descriptors are referred to as <code>diff_data_desc</code>.</li>
<li>Both forward and backward propagation support in-place operations, meaning that <code>src</code> can be used as input and output for forward propagation, and <code>diff_dst</code> can be used as input and output for backward propagation. In case of in-place operation, the original data will be overwritten.</li>
<li>For some operations it might be performance beneficial to compute backward propagation based on \(dst(\overline{x})\), rather than on \(src(\overline{x})\). However, for some other operations this is simply impossible. So for generality the library always requires \(src\).</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>For the ReLU operation with \(\alpha = 0\), \(dst\) can be used instead of \(src\) and \(dst\) when backward propagation is computed. This enables several performance optimizations (see the tips below).</dd></dl>
<h3>Data Type Support</h3>
<p>The eltwise primitive supports the following combinations of data types:</p>
<table class="doxtable">
<tr>
<th align="left">Propagation </th><th align="left">Source / Destination </th><th align="left">Intermediate data type  </th></tr>
<tr>
<td align="left">forward / backward </td><td align="left">f32, bf16 </td><td align="left">f32 </td></tr>
<tr>
<td align="left">forward </td><td align="left">f16 </td><td align="left">f16 </td></tr>
<tr>
<td align="left">forward </td><td align="left">s32 / s8 / u8 </td><td align="left">f32 </td></tr>
</table>
<dl class="section warning"><dt>Warning</dt><dd>There might be hardware and/or implementation specific restrictions. Check <a class="el" href="dev_guide_eltwise.html#dg_eltwise_impl_limits">Implementation Limitations</a> section below.</dd></dl>
<p>Here the intermediate data type means that the values coming in are first converted to the intermediate data type, then the operation is applied, and finally the result is converted to the output data type.</p>
<h3>Data Representation</h3>
<p>The eltwise primitive works with arbitrary data tensors. There is no special meaning associated with any logical dimensions.</p>
<h3>Post-ops and Attributes</h3>
<p>The eltwise primitive doesn't support any post-ops or attributes.</p>
<p><a class="anchor" id="dg_eltwise_impl_limits"></a></p>
<h2>Implementation Limitations</h2>
<ol type="1">
<li>Refer to <a class="el" href="dev_guide_data_types.html">Data Types</a> for limitations related to data types support.</li>
</ol>
<h2>Performance Tips</h2>
<ol type="1">
<li>For backward propagation, use the same memory format for <code>src</code>, <code>diff_dst</code>, and <code>diff_src</code> (the format of the <code>diff_dst</code> and <code>diff_src</code> are always the same because of the API). Different formats are functionally supported but lead to highly suboptimal performance.</li>
<li>Use in-place operations whenever possible.</li>
<li>As mentioned above for the ReLU operation with \(\alpha = 0\), one can use the \(dst\) tensor instead of \(src\). This enables the following potential optimizations for training:<ul>
<li>ReLU can be safely done in-place.</li>
<li>Moreover, ReLU can be fused as a <a class="el" href="dev_guide_attributes.html">post-op</a> with the previous operation if that operation doesn't require its \(dst\) to compute the backward propagation (e.g., if the convolution operation satisfies these conditions). </li>
</ul>
</li>
</ol>
</div></div><!-- contents -->
<div class="footer">
    <div class="footer-wrapper">
        <ul id="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>