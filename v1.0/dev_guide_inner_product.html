<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Intel(R) MKL-DNN: Inner Product</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">Intel(R) Math Kernel Library for Deep Neural Networks (Intel(R) MKL-DNN)
   &#160;<span id="projectnumber">1.0.4</span>
   </div>
   <div id="projectbrief">Performance library for Deep Learning</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Inner Product </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p></p>
<p>API reference: <a class="el" href="group__c__api__inner__product.html">C</a>, <a class="el" href="group__cpp__api__inner__product.html">C++</a></p>
<p></p>
</blockquote>
<p>The inner product primitive (sometimes called fully connected) treats each activation in the minibatch as a vector and computes its product with a weights 2D tensor producing a 2D tensor as an output.</p>
<p>More precisely, let \(src\), \(weights\), \(bias\) and \(dst\) be \(N \times IC\), \(OC \times IC\), \(OC\), \(N \times OC\) tensors (the variable names follow the standard <a class="el" href="dev_guide_conventions.html">Naming Conventions</a>). Then:</p>
<p class="formulaDsp">
\[dst(n, oc) = bias(oc) + \sum_{ic=0}^{IC-1} src(n, ic) \cdot weights(oc, ic)\]
</p>
<p>In case when the \(src\) tensor has spatial dimension it is flattened to 2D. For example, if it is a 4D \(N \times IC&#39; \times IH \times IW\) tensor, then the formula above is applied with \(IC = IC&#39; \cdot IH \cdot IW\).</p>
<h4>Difference Between <a href="#mkldnn::forward_training">Forward Training</a> and <a href="#mkldnn::forward_inference">Forward Inference</a></h4>
<p>There is no difference between the <a class="el" href="group__cpp__api__enums.html#ggaeb087eae78f70a4d249a90aefa165cf8a24775787fab8f13aa4809e1ce8f82aeb">mkldnn::forward_training</a> and <a class="el" href="group__cpp__api__enums.html#ggaeb087eae78f70a4d249a90aefa165cf8a3b9fad4f80d45368f856b5403198ac4c">mkldnn::forward_inference</a> propagation kinds.</p>
<h3>Backward</h3>
<p>The backward propagation computes \(diff\_src\) based on \(diff\_dst\) and \(weights\).</p>
<p>The weights update computes \(diff\_weights\) and \(diff\_bias\) based on \(diff\_dst\) and \(src\).</p>
<dl class="section note"><dt>Note</dt><dd>The <em>optimized</em> memory formats \(src\) and \(weights\) might be different on forward propagation, backward propagation, and weights update.</dd></dl>
<h2>Implementation Details</h2>
<h3>General Notes</h3>
<p>N/A.</p>
<h3>Data Types</h3>
<p>Inner product primitive supports the following combination of data types for source, destination, weights, and bias:</p>
<table class="doxtable">
<tr>
<th align="left">Propagation </th><th align="left">Source </th><th align="left">Weights </th><th align="left">Destination </th><th align="left">Bias  </th></tr>
<tr>
<td align="left">forward / backward </td><td align="left">f32 </td><td align="left">f32 </td><td align="left">f32 </td><td align="left">f32 </td></tr>
<tr>
<td align="left">forward </td><td align="left">f16 </td><td align="left">f16 </td><td align="left">f16 </td><td align="left">f16 </td></tr>
<tr>
<td align="left">forward </td><td align="left">u8, s8 </td><td align="left">s8 </td><td align="left">u8, s8, s32, f32 </td><td align="left">u8, s8, s32, f32 </td></tr>
</table>
<h3>Data Representation</h3>
<p>Like other CNN primitives, the inner product primitive expects the following tensors:</p>
<table class="doxtable">
<tr>
<th align="left">Spatial </th><th align="left">Source </th><th align="left">Destination </th><th align="left">Weights  </th></tr>
<tr>
<td align="left">1D </td><td align="left">\(N \times C \times W\) </td><td align="left">\(N \times C\) </td><td align="left">\(OC \times IC \times KW\) </td></tr>
<tr>
<td align="left">2D </td><td align="left">\(N \times C \times H \times W\) </td><td align="left">\(N \times C\) </td><td align="left">\(OC \times IC \times KH \times KW\) </td></tr>
<tr>
<td align="left">3D </td><td align="left">\(N \times C \times D \times H \times W\) </td><td align="left">\(N \times C\) </td><td align="left">\(OC \times IC \times KD \times KH \times KW\) </td></tr>
</table>
<p>Memory format of data and weights memory objects is critical for inner product primitive performance. In the Intel MKL-DNN programming model, inner product primitive is one of the few primitives that support the placeholder format <a class="el" href="structmkldnn_1_1memory.html#a123930e31c5460c2c5f052a59c2a4ceda100b8cad7cf2a56f6df78f171f97a1ec" title="Placeholder memory format tag. ">mkldnn::memory::format_tag::any</a> (shortened to <code>any</code> from now on) and can define data and weight memory objects formats based on the primitive parameters. When using <code>any</code> it is necessary to first create an inner product primitive descriptor and then query it for the actual data and weight memory objects formats.</p>
<p>The table below shows the combinations for which <b>plain</b> memory formats the inner product primitive is optimized for. For the destination tensor (which is always \(N \times C\)) the memory format is always <a class="el" href="structmkldnn_1_1memory.html#a123930e31c5460c2c5f052a59c2a4ceda1e7342845e24eb3b5b3554490da1c128" title="2D CNN activations tensor, an alias to mkldnn::memory::format_tag::ab ">mkldnn::memory::format_tag::nc</a> (<a class="el" href="structmkldnn_1_1memory.html#a123930e31c5460c2c5f052a59c2a4ceda187ef4436122d1cc2f40dc2b92f0eba0" title="plain 2D tensor ">mkldnn::memory::format_tag::ab</a>).</p>
<table class="doxtable">
<tr>
<th align="left">Spatial </th><th align="left">Source / Weights logical tensor </th><th align="left">Implementation optimized for memory formats  </th></tr>
<tr>
<td align="left">0D </td><td align="left">NC / OI </td><td align="left"><a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba2838f6827b40434fb9584eb3efe1a0ae" title="2D CNN activations tensor, an alias to mkldnn_ab ">mkldnn_nc</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba50ffa304d45d50709fdc192f6b286163" title="plain 2D tensor ">mkldnn_ab</a>) / <a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2bae5344fffd9e1e8c46ced6403c21310b1" title="2D CNN weights tensor, an alias to mkldnn_ab ">mkldnn_oi</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba50ffa304d45d50709fdc192f6b286163" title="plain 2D tensor ">mkldnn_ab</a>) </td></tr>
<tr>
<td align="left">0D </td><td align="left">NC / OI </td><td align="left"><a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba2838f6827b40434fb9584eb3efe1a0ae" title="2D CNN activations tensor, an alias to mkldnn_ab ">mkldnn_nc</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba50ffa304d45d50709fdc192f6b286163" title="plain 2D tensor ">mkldnn_ab</a>) / <a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba433ebc123e9f80c292c0e6e82715c118" title="2D CNN weights tensor, an alias to mkldnn_ba ">mkldnn_io</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2baa1b1a627050d3f5d5477b4bf662c1f95" title="permuted 2D tensor ">mkldnn_ba</a>) </td></tr>
<tr>
<td align="left">1D </td><td align="left">NCW / OIW </td><td align="left"><a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2baa9593899799f130c7f511f09b5c1ea9d" title="3D CNN activations tensor, an alias to mkldnn_abc ">mkldnn_ncw</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba3f9bf8e8dfb966d5fb76844fb8cc758d" title="plain 3D tensor ">mkldnn_abc</a>) / <a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba6a18734c3be6fcf4b2c0ce501816cb61" title="3D CNN weights tensor, an alias to mkldnn_abc ">mkldnn_oiw</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba3f9bf8e8dfb966d5fb76844fb8cc758d" title="plain 3D tensor ">mkldnn_abc</a>) </td></tr>
<tr>
<td align="left">1D </td><td align="left">NCW / OIW </td><td align="left"><a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba23e0a15956f5406d591d776d852446a3" title="3D CNN activations tensor, an alias to mkldnn_acb ">mkldnn_nwc</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba975488028c2512fda82be106e36c8b35" title="permuted 3D tensor ">mkldnn_acb</a>) / <a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba32b0c647332e8d67f0c9146a78bd2e7a" title="3D CNN weights tensor, an alias to mkldnn_cba ">mkldnn_wio</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2baa64ff960aa3225ad2aeef83e237d3b5f" title="permuted 3D tensor ">mkldnn_cba</a>) </td></tr>
<tr>
<td align="left">2D </td><td align="left">NCHW / OIHW </td><td align="left"><a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2baed4a51a8db128a648b942882369a06d6" title="4D CNN activations tensor, an alias to mkldnn_abcd ">mkldnn_nchw</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba63203c48f8a6ff36dbf21e8c81bca060" title="plain 4D tensor ">mkldnn_abcd</a>) / <a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2bacc2eeaa304a91dc0d8ec301a8a13fa4a" title="4D CNN weights tensor, an alias to mkldnn_abcd ">mkldnn_oihw</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba63203c48f8a6ff36dbf21e8c81bca060" title="plain 4D tensor ">mkldnn_abcd</a>) </td></tr>
<tr>
<td align="left">2D </td><td align="left">NCHW / OIHW </td><td align="left"><a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2badf1fb06f73cf8dd23ae620eea6516526" title="4D CNN activations tensor, an alias to mkldnn_acdb ">mkldnn_nhwc</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba5bdb52f009d9c8b46aaf05119cf18592" title="permuted 4D tensor ">mkldnn_acdb</a>) / <a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba56fdb8a888dba3cd5bb8e5a0bd521f8f" title="4D CNN weights tensor, an alias to mkldnn_cdba ">mkldnn_hwio</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba4b652226a3878ad2c7471f1519da6c41" title="permuted 4D tensor ">mkldnn_cdba</a>) </td></tr>
<tr>
<td align="left">3D </td><td align="left">NCDHW / OIDHW </td><td align="left"><a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba55268cf202bb4367b19fd0aeb13739ce" title="5D CNN activations tensor, an alias to mkldnn_abcde ">mkldnn_ncdhw</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2bab5a0a1dc7021e96ed7e174f76f8decbc" title="plain 5D tensor ">mkldnn_abcde</a>) / <a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2bafac4917edc105faa444307270eb0d1a5" title="5D CNN weights tensor, an alias to mkldnn_abcde ">mkldnn_oidhw</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2bab5a0a1dc7021e96ed7e174f76f8decbc" title="plain 5D tensor ">mkldnn_abcde</a>) </td></tr>
<tr>
<td align="left">3D </td><td align="left">NCDHW / OIDHW </td><td align="left"><a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2bafe9f8381139e749050fda6fb70808e1c" title="5D CNN activations tensor, an alias to mkldnn_acdeb ">mkldnn_ndhwc</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2bae659343dce6f6dd2eaf8f7a9455be26d" title="permuted 5D tensor ">mkldnn_acdeb</a>) / <a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba6669e57588b920dcd21b951ac7eb1682" title="5D CNN weights tensor, an alias to mkldnn_cdeba ">mkldnn_dhwio</a> (<a class="el" href="group__c__api__types__generic.html#ggacc2844e341ab1c4f5b7ae1c6068f2a2ba0a04f3c51661b874c8e2fcfff1bf0019" title="permuted 5D tensor ">mkldnn_cdeba</a>) </td></tr>
</table>
<h3>Post-ops and Attributes</h3>
<p>Post-ops and attributes enable you to modify the behavior of the inner product primitive by chaining certain operations after the inner product operation. The following post-ops are supported by inner product primitives:</p>
<table class="doxtable">
<tr>
<th align="left">Propagation </th><th align="left">Type </th><th align="left">Operation </th><th align="left">Description  </th></tr>
<tr>
<td align="left">forward </td><td align="left">post-op </td><td align="left">eltwise </td><td align="left">Applies an <a class="el" href="group__c__api__eltwise.html">Eltwise</a> operation to the result (currently only <a class="el" href="group__c__api__types__generic.html#ggaa27d43cdd1e439cc41a9580d23ce3e97a66ead6848424f0b494e813745efb5548" title="Eltwise: ReLU. ">mkldnn_eltwise_relu</a> algorithm is supported) </td></tr>
</table>
<h2>Implementation Limitations</h2>
<ol type="1">
<li>Check <a class="el" href="dev_guide_data_types.html">Data Types</a>.</li>
</ol>
<h2>Performance Tips</h2>
<ul>
<li>Use <a class="el" href="structmkldnn_1_1memory.html#a123930e31c5460c2c5f052a59c2a4ceda100b8cad7cf2a56f6df78f171f97a1ec" title="Placeholder memory format tag. ">mkldnn::memory::format_tag::any</a> for source, weights, and destinations memory format tags when create an inner product primitive to allow the library to choose the most appropriate memory format. </li>
</ul>
</div></div><!-- contents -->
<div class="footer">
    <div class="footer-wrapper">
        <ul id="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>