<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>oneDNN: Primitive Attributes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script src="assets/mathjax/MathJax.js?config=TeX-AMS_CHTML,dnnl"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
<link href="assets/customdoxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="assets/dnn.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
   <div id="projectname">oneAPI Deep Neural Network Library (oneDNN)
   &#160;<span id="projectnumber">1.4.0</span>
   </div>
   <div id="projectbrief">Performance library for Deep Learning</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Primitive Attributes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A quick recap of the primitive creation step, which consists of the following:</p>
<ol type="1">
<li>Initializing an operation descriptor, which contains some basic information about the operation.</li>
<li>Creating a primitive descriptor based on the operation descriptor, engine, and <b>attributes</b>. During creation of a primitive for backward propagation, the primitive descriptor from the forward propagation might be required as well (see <a class="el" href="dev_guide_inference_and_training_aspects.html#dev_guide_inference_and_training_aspects_training">Training-Specific Aspects</a>).</li>
<li>Creating a primitive, solely based on a primitive descriptor.</li>
</ol>
<p>Details on why all these steps are required can be found in <a class="el" href="dev_guide_basic_concepts.html">Basic Concepts</a>. The fact that is important for us now is that a primitive descriptor created at step 2 fully defines the operation that the corresponding primitive will execute. Once the primitive descriptor is created, it cannot be changed.</p>
<p>The parameters passed to create a primitive descriptor specify the problem. An engine specifies where the primitive will be executed. An operation descriptor specifies the basics: the operation kind; the propagation kind; the source, destination, and other tensors; the strides (if applicable); and so on.</p>
<p><b>Attributes</b> specify some extra properties of the primitive. The attributes were designed to be extensible, hence they are an opaque structure. Users must create them before use and must set required specifics using the corresponding setters. The attributes are copied during primitive descriptor creation, so users can change or destroy attributes right after that.</p>
<p>If nothing special is required, attributes can stay empty, which is equivalent to the default attributes. For that purpose in the C API users can pass <code>NULL</code> as an attribute to the <a class="el" href="group__dnnl__api__primitives__common.html#ga336dd467c36d8fe0d3311ddc73f239cb">dnnl_primitive_desc_create</a> function. In the C++ API, primitive descriptors' constructors have empty attributes as default parameters, so unless required users can simply omit them.</p>
<h2>Attributes Usage</h2>
<p>Below are the skeletons of using attributes with the C and C++ APIs. Error handling is omitted to simplify reading.</p>
<div class="fragment"><div class="line"><span class="comment">// ### C API ###</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__dnnl__api__primitives__common.html#ga8aa7e594f8ce4c98bd6dc8294e4003e5">dnnl_op_desc_t</a> <a class="code" href="group__dnnl__api__primitives__common.html#gga94efdd650364f4d9776cfb9b711cbdc1a80d6826f84ba733d4bd57ca0812d1d24">op_d</a>; <span class="comment">// some operation descriptor, e.g. dnnl_eltwise_desc_t</span></div>
<div class="line">...</div>
<div class="line"><span class="comment">// init op_d</span></div>
<div class="line"></div>
<div class="line">dnnl_primitive_attr_t attr; <span class="comment">// opaque attributes</span></div>
<div class="line"><a class="code" href="group__dnnl__api__attributes.html#gaf630fdc0d8d0fd8522ec93852a559081">dnnl_primitive_attr_create</a>(&amp;attr);</div>
<div class="line">dnnl_primitive_attr_set_SOMETHING(attr, params); <span class="comment">// setting attributes params</span></div>
<div class="line">dnnl_primitive_attr_set_SOMETHING_ELSE(attr, other_params);</div>
<div class="line"></div>
<div class="line"><a class="code" href="structdnnl__primitive__desc.html">dnnl_primitive_desc_t</a> op_pd; <span class="comment">// operation primitive descriptor</span></div>
<div class="line"><a class="code" href="group__dnnl__api__primitives__common.html#ga336dd467c36d8fe0d3311ddc73f239cb">dnnl_primitive_desc_create</a>(&amp;op_pd, &amp;op_d, attr, engine, hint_fwd_pd);</div>
<div class="line"></div>
<div class="line"><span class="comment">// changing attr object here doesn&#39;t have any effect on op_pd</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// once attr is no more used we can immediately destroy it</span></div>
<div class="line"><a class="code" href="group__dnnl__api__attributes.html#ga96a7539382945195627f2932bff8fadb">dnnl_primitive_attr_destroy</a>(attr);</div>
<div class="line"></div>
<div class="line">...</div>
<div class="line"></div>
<div class="line"><span class="comment">// ### C++ API ###</span></div>
<div class="line"></div>
<div class="line">dnnl::primitive_attr attr;</div>
<div class="line">attr.set_SOMETHING(params);</div>
<div class="line">attr.set_SOMETHING_ELSE(params);</div>
<div class="line"></div>
<div class="line">primitive::primitive_desc pd(..., attr);</div>
<div class="line"></div>
<div class="line"><span class="comment">// in C++ destroying of attr happens automatically</span></div>
</div><!-- fragment --><h2>Supported Attributes</h2>
<p>As mentioned above, the attributes enable extending or changing the default primitive behavior. Currently the following attributes are supported. The detailed explanation is provided in the corresponding sections.</p>
<ul>
<li><a class="el" href="dev_guide_attributes_scratchpad.html">Scratchpad</a> behavior: handling the intermediate temporary memory by the library or a user;</li>
<li><a class="el" href="dev_guide_attributes_quantization.html">Quantization</a> settings used in INT8 inference;</li>
<li><a class="el" href="dev_guide_attributes_post_ops.html">Post-ops</a> to fuse a primitive with some operation applied to the primitive's result. Used mostly for inference.</li>
</ul>
<h2>Attribute Related Error Handling</h2>
<p><a class="anchor" id="dev_guide_attributes_error_handling"></a> Unfortunately, the attribute extension API allows specifying properties that the library currently doesn't support. Since the attributes are created separately from the corresponding primitive descriptor, users can successfully set attributes in whatever configuration they want. However, when they try to create a primitive descriptor with the attribute it might appear that neither implementation supports such a configuration. In this case a user will get <a class="el" href="group__dnnl__api__utils.html#ggad24f9ded06e34d3ee71e7fc4b408d57aa3a8579e8afc4e23344cd3115b0e81de1" title="The operation failed because requested functionality is not implemented. ">dnnl_unimplemented</a> in the case of the C API or a corresponding <a class="el" href="structdnnl_1_1error.html">dnnl::error</a> object as an exception in the case of the C++ API. Unfortunately, the library doesn't currently provide any hints about what exactly is going wrong in this case. The corresponding section of the documentation simply documents the primitives' capabilities.</p>
<dl class="section warning"><dt>Warning</dt><dd>Error handling of attributes might be complicated and obscure. </dd></dl>
</div></div><!-- contents -->
<div class="footer">
    <div class="footer-wrapper">
        <ul id="footer-links">
            <li><a href="legal_information.html">Legal information</a></li>
        </ul>
    </div>
</div>